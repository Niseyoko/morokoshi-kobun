<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            width: 100vw;
            min-height: 100vh;
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .title {
            width: 100%;
            height: 10vh;
            /* background-color:blue; */
            /* color:white; */
            font-size: 3vh;
            /* text-align: center; */
            /* line-height: 10vh; */
            border-bottom: 1px solid #000;
            display: flex;
            justify-content: space-evenly;
            align-items: center;
        }

        .yet {
            color: hsl(0, 0%, 81%);
        }

        .correct {
            color: hsl(129, 100%, 39%);
        }

        .wrong {
            color: hsl(0, 100%, 71%);
        }

        .question_container {
            display: flex;
            justify-content: center;
            align-content: center;
            max-height: 60vh;
        }

        .question {
            padding: 15px;
            /* width:100%; */
            /* max-height:100vh; */
            /* background-color:blue; */
            /* color:white; */
            /* text-align:center; */
            line-height: 10vw;
            /* border-bottom: 1px solid #000; */
            /* writing-mode: vertical-rl; */
            display: flex;
            flex-direction: row-reverse;
            justify-content: center;
            align-items: center;
        }

        .start {
            font-size: 14vw !important;
        }

        .question>div {
            writing-mode: vertical-rl;
        }

        .question>div:nth-child(even) {
            font-size: 5vw;
        }

        .question>div:nth-child(odd) {
            align-self: end;
            font-size: 4vw;
        }

        .opt_container {
            width: 100%;
            /* height:90vh; */
            /* background-color:yellow; */
            display: flex;
            flex-wrap: wrap;
            justify-content: space-evenly;
        }

        .opt {
            width: 40%;
            /* height:10vh; */
            /* background-color:blue; */
            /* color:white; */
            font-size: 5vw;
            display: flex;
            justify-content: center;
            align-items: center;
            /* line-height:10vh; */
            border: 2px solid;
            border-color: hsl(129, 0, 0);
            background-color: hsl(129, 100, 100);
            border-radius: 30px;
            margin: 1%;
            padding: 10px;
            transition-property: border-color, background-color;
            transition-duration: .25s;
        }

        .opt>div {
            text-align: center;
        }

        .selected .ok {
            border-color: hsl(129, 100%, 39%);
            background-color: hsl(126, 100%, 98.8%);
        }

        .selected .ng {
            border-color: hsl(334, 100%, 39%);
            background-color: hsl(334, 100%, 99%);
        }
    </style>
    <title>古文単語一問一答集</title>
</head>

<body>
    <div class="title">
        <!-- タイトル -->
        <div class="yet">100</div>
        <div class="correct">200</div>
        <div class="wrong">300</div>
    </div>
    <div class="question_container">
        <div class="question">
            <div class="start">スタートする！</div>
        </div>
    </div>
    <div class="opt_container">
        <button  type="button" class="opt ok">
            <div>ㅤ</div>
        </button>
        <button  type="button" class="opt ok">
            <div>ㅤ</div>
        </button>
        <button  type="button" class="opt ok">
            <div>ㅤ</div>
        </button>
        <button  type="button" class="opt ok">
            <div>ㅤ</div>
        </button>
    </div>
    <script src="/scripts/data.js"></script>
    <script>
        let userdata = data.map(() => {
            return {
                is_answered: false,
                is_solved: false,
            }
        });;
        let [yet, correct, wrong] = [userdata.length, 0, 0];
        function f() {
            [yet, correct, wrong] = [userdata.length, 0, 0];
            for (i of userdata) {
                if (i.is_answered) {
                    if (i.is_solved) {
                        correct++;
                    }
                    else {
                        wrong++;
                    }
                }
                else {
                    yet++;
                }
            }
            const title = document.querySelector('.title');
            title.innerHTML = `
                <div class="yet">${yet}</div>
                <div class="correct">${correct}</div>
                <div class="wrong">${wrong}</div>
                `;
        }
        if (localStorage.getItem("userdata")) {
            userdata = JSON.parse(localStorage.getItem("userdata"));
        }
        else {
            localStorage.setItem("userdata", JSON.stringify(data));
        }
        f();
        data = data.entries();

        const shuffle = ([...array]) => {
            for (let i = array.length - 1; i >= 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        data = shuffle(data);

        let index = -1;

        function update() {
            const question = document.querySelector('.question');
            question.innerHTML = `
            <div>${data[index][1].l}</div>
            <div>${data[index][1].q}</div>
            <div>${data[index][1].f}</div>
            <div>${data[index][1].t}</div>
            `;

            const opt = document.querySelectorAll('.opt');
            const [a, b, c, d] = data[index][1].o;
            const shuffled = shuffle([["ok", a], ["ng", b], ["ng", c], ["ng", d]]);
            opt.forEach((e, i) => {
                e.innerHTML = `<div>${shuffled[i][1]}</div>`;
                e.classList.remove("ok", "ng");
                e.classList.add(shuffled[i][0]);
            });
            // console.log(data[index][0])

        }

        let clicked = false;
        const opt = document.querySelectorAll('.opt');
        opt.forEach((e) => {
            e.addEventListener('click', () => {
                // console.log(index);
                clicked = true;
                e.parentElement.classList.add('selected');
                if (index !== -1) {
                    //スタートする！
                    const index_=data[index][0]
                    if (!userdata[index_].is_answered) {
                        if (e.classList.contains('ok')) {
                            // console.log("正解");
                            userdata[index_].is_solved = true;
                        } else {
                            userdata[index_].is_solved = false;
                            // console.log("不正解");
                        }
                    }
                    userdata[index_].is_answered = true;

                }
                f();
                localStorage.setItem("userdata", JSON.stringify(userdata));
            });
        });
        document.querySelector(".question_container").addEventListener('click', (e) => {
            if (clicked) {
                clicked = false;
                if (index >= data.length) {
                    return;
                }
                index++;
                update();
                document.querySelector(".selected").classList.remove("selected")
            }
        });
    </script>
</body>

</html>